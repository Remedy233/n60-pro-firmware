# 磊科 N60 Pro iStoreOS 固件编译快速指南

> 基于 ImmortalWrt MT798x + iStoreOS 核心组件

## 🚀 快速开始（Windows 用户）

### 第一步：安装 WSL2

1. **以管理员身份**打开 PowerShell
2. 运行命令：
```powershell
wsl --install
```
3. 重启电脑
4. 首次启动会自动安装 Ubuntu，设置用户名和密码

### 第二步：准备编译环境

在 WSL 终端中运行（或直接双击`开始编译.bat`会自动进入WSL）：

```bash
# 更新系统
sudo apt update

# 安装编译依赖
sudo apt install -y build-essential clang flex bison g++ gawk \
gcc-multilib g++-multilib gettext git libncurses5-dev libssl-dev \
python3-distutils rsync unzip zlib1g-dev file wget
```

### 第三步：开始编译

**方法一：双击运行（推荐）**
- 直接双击 `开始编译.bat` 文件

**方法二：手动运行**
```bash
# 在 WSL 中进入项目目录
cd "/mnt/c/Users/wangr/Desktop/n60 pro"

# 赋予执行权限
chmod +x build.sh

# 开始编译
./build.sh
```

### 第四步：等待完成

- 首次编译：2-6 小时（取决于网络和硬件）
- 二次编译：30 分钟 - 2 小时

## 📦 编译产物位置

编译完成后，固件位于：
```
immortalwrt-mt798x/bin/targets/mediatek/mt7981/
```

关键文件：
- `immortalwrt-*-n60-pro-*-sysupgrade.bin` - 用于系统升级
- `immortalwrt-*-n60-pro-*-factory.bin` - 用于首次刷入

## 🎉 固件特性

✅ **iStore 应用商店** - 丰富的应用一键安装  
✅ **QuickStart 快速入门** - 新手友好的配置向导  
✅ **MT7981B 完整支持** - 无线性能优化，驱动完善  
✅ **中文优化界面** - 更适合国内用户使用

## 🔧 自定义配置

### 修改默认 IP 地址
编辑 `diy-part2.sh`，取消注释并修改：
```bash
sed -i 's/192.168.1.1/192.168.10.1/g' package/base-files/files/bin/config_generate
```

### 添加额外插件
编辑 `diy-part2.sh`，添加：
```bash
./scripts/feeds install -a luci-app-插件名
```

### 修改配置文件
```bash
# 进入源码目录
cd istoreos

# 打开配置菜单
make menuconfig

# 保存配置
cp .config ../n60-pro.config
```

## 💾 刷入固件

### 方法1：Web 界面升级（推荐）
1. 登录路由器：http://192.168.1.1
2. 进入 **系统** → **备份/升级**
3. 上传 `sysupgrade.bin` 文件
4. 点击刷写固件

### 方法2：Breed 模式刷入
1. 进入 Breed 界面（通常是断电按住 Reset 再上电）
2. 选择固件更新
3. 上传 `factory.bin` 文件
4. 等待刷写完成并重启

## ❓ 常见问题

### Q1: 编译失败，提示下载错误
**A:** 网络问题，重新运行 `./build.sh` 会继续未完成的下载

### Q2: 空间不足
**A:** 确保至少有 50GB 可用空间，可以删除 WSL 中的其他大文件

### Q3: 如何清理编译文件
**A:** 运行 `./build.sh clean` 清理，或 `./build.sh distclean` 深度清理

### Q4: 如何更新源码
**A:** 运行 `./build.sh update`

### Q5: WSL 访问 Windows 文件慢
**A:** 建议将项目移到 WSL 文件系统：
```bash
# 在 WSL 中
cp -r "/mnt/c/Users/wangr/Desktop/n60 pro" ~/n60-pro
cd ~/n60-pro
```

### Q6: 固件太大无法刷入
**A:** 编辑 `n60-pro.config`，去除不需要的包，重新编译

## 📋 编译脚本命令

```bash
./build.sh          # 完整编译流程
./build.sh compile  # 仅编译（假设已准备好）
./build.sh update   # 更新源码和 feeds
./build.sh clean    # 清理编译文件
./build.sh distclean # 深度清理
./build.sh help     # 显示帮助
```

## 🔗 相关链接

- [ImmortalWrt MT798x 项目](https://github.com/padavanonly/immortalwrt-mt798x-6.6)
- [iStoreOS 官方仓库](https://github.com/istoreos/istoreos)
- [OpenWrt 官方文档](https://openwrt.org/docs/start)

## ⚠️ 注意事项

1. ✅ 首次编译需要下载大量源码和依赖包
2. ✅ 保持网络连接稳定
3. ✅ 不要在编译过程中关闭终端
4. ✅ 刷机有风险，建议先备份原厂固件
5. ✅ 确保固件文件完整，不要用损坏的固件刷机

## 📞 支持

如有问题，请检查：
1. `istoreos/logs` 目录下的日志文件
2. 确保所有依赖已正确安装
3. 网络连接正常

---

**祝编译顺利！** 🎉
