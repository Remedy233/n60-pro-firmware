# 磊科 N60 Pro iStoreOS 固件项目说明

## 📋 项目概述

本项目为磊科 N60 Pro 路由器创建了一个 **混合固件编译方案**，结合了两个优秀项目的优势：

### 🔧 技术架构

```
┌─────────────────────────────────────────┐
│      磊科 N60 Pro iStoreOS 固件         │
├─────────────────────────────────────────┤
│                                         │
│  ┌───────────────────────────────────┐  │
│  │   iStoreOS 核心组件层             │  │
│  ├───────────────────────────────────┤  │
│  │ • iStore 应用商店                 │  │
│  │ • QuickStart 快速入门向导         │  │
│  │ • TaskD 任务管理                  │  │
│  │ • 中文优化界面                    │  │
│  └───────────────────────────────────┘  │
│                                         │
│  ┌───────────────────────────────────┐  │
│  │   ImmortalWrt MT798x 底层         │  │
│  ├───────────────────────────────────┤  │
│  │ • MT7981B 完整驱动                │  │
│  │ • 6.6 Linux 内核                  │  │
│  │ • 针对国内网络优化                │  │
│  │ • OpenWrt 24.10 基础              │  │
│  └───────────────────────────────────┘  │
│                                         │
└─────────────────────────────────────────┘
```

## 🎯 为什么选择这个方案？

### ImmortalWrt MT798x 作为底层 ✅

**选择原因：**
- ✅ **专为 MT798x 系列优化** - 包含 MT7981B 的完整驱动和优化
- ✅ **6.6 稳定内核** - 最新的长期支持内核版本
- ✅ **无线性能优化** - WiFi 驱动经过深度优化
- ✅ **活跃维护** - 社区活跃，更新及时
- ✅ **国内网络优化** - 软件源和下载速度更快

**项目地址：** [padavanonly/immortalwrt-mt798x-6.6](https://github.com/padavanonly/immortalwrt-mt798x-6.6)

### iStoreOS 作为应用层 ✅

**选择原因：**
- ✅ **iStore 应用商店** - 丰富的应用生态，一键安装
- ✅ **QuickStart 向导** - 新手友好，快速配置
- ✅ **中文本地化** - 完善的中文界面和文档
- ✅ **易用性强** - 专为国内用户设计
- ✅ **NAS 功能** - 适合家庭存储和共享

**项目地址：** [istoreos/istoreos](https://github.com/istoreos/istoreos)

## 🔄 编译流程

### 1. 克隆 ImmortalWrt MT798x 源码
```bash
git clone -b openwrt-24.10-6.6 --single-branch --filter=blob:none \
  https://github.com/padavanonly/immortalwrt-mt798x-6.6.git
```

### 2. 添加 iStoreOS Feeds（diy-part1.sh）
```bash
# 添加 iStore 应用商店源
src-git istore https://github.com/linkease/istore.git;main

# 添加 iStoreOS 软件包源（包含 quickstart）
src-git istoreos_packages https://github.com/istoreos/istoreos.git;istoreos-24.10
```

### 3. 安装 iStoreOS 组件（diy-part2.sh）
```bash
# 安装核心组件
./scripts/feeds install -a -f -p istore
./scripts/feeds install -a -f -p istoreos_packages

# 安装关键应用
- luci-app-store        # iStore 应用商店
- quickstart            # 快速入门后端
- luci-app-quickstart   # 快速入门前端
- taskd                 # 任务管理守护进程
- istoreos-files        # iStoreOS 配置文件
```

### 4. 应用配置文件（n60-pro.config）
```bash
# 目标平台
CONFIG_TARGET_mediatek_mt7981_DEVICE_netcore_n60-pro=y

# iStoreOS 组件
CONFIG_PACKAGE_luci-app-store=y
CONFIG_PACKAGE_quickstart=y
CONFIG_PACKAGE_luci-app-quickstart=y
CONFIG_PACKAGE_taskd=y
```

### 5. 编译固件
```bash
make -j$(nproc) V=s
```

## 📦 固件特性

### ✨ 核心功能

| 功能 | 说明 | 来源 |
|------|------|------|
| **iStore 应用商店** | 一键安装 Docker、青龙面板等应用 | iStoreOS |
| **QuickStart 向导** | 新手友好的配置向导 | iStoreOS |
| **MT7981B 驱动** | WiFi、交换机完整驱动支持 | ImmortalWrt MT798x |
| **6.6 内核** | 最新稳定 LTS 内核 | ImmortalWrt MT798x |
| **中文界面** | 完善的中文本地化 | iStoreOS + ImmortalWrt |
| **任务管理** | 后台任务和计划任务 | iStoreOS |

### 🔌 预装应用

- **网络工具**: UPnP, DDNS, 防火墙
- **文件共享**: Samba4 文件共享
- **系统工具**: TTYD 终端, 系统监控
- **存储支持**: USB 存储, NTFS/EXT4 支持

## 📂 项目文件说明

```
n60 pro/
├── build.sh              # 主编译脚本（自动化整个流程）
├── diy-part1.sh          # Feeds 配置（添加 iStoreOS 源）
├── diy-part2.sh          # 组件安装（集成 iStoreOS 功能）
├── n60-pro.config        # 编译配置文件（MT7981 + iStoreOS）
│
├── README.md             # 详细说明文档
├── 快速指南.md           # 快速上手指南
├── 编译说明.txt          # 文本格式说明
├── 项目说明.md           # 本文件（架构说明）
│
├── 开始编译.bat          # Windows 快捷启动脚本
└── .gitignore            # Git 忽略配置
```

## 🚀 快速开始

### Windows 用户（推荐）

1. **安装 WSL2**
   ```powershell
   wsl --install
   ```

2. **双击运行**
   ```
   双击 "开始编译.bat"
   ```

### Linux 用户

```bash
# 安装依赖
sudo apt install -y build-essential git ...

# 开始编译
chmod +x build.sh
./build.sh
```

## 📊 编译产物

编译完成后的固件位置：
```
immortalwrt-mt798x/bin/targets/mediatek/mt7981/
├── immortalwrt-mediatek-mt7981-netcore_n60-pro-squashfs-sysupgrade.bin
└── immortalwrt-mediatek-mt7981-netcore_n60-pro-squashfs-factory.bin
```

## ⚙️ 自定义配置

### 修改默认 IP
编辑 `diy-part2.sh`：
```bash
sed -i 's/192.168.1.1/192.168.10.1/g' package/base-files/files/bin/config_generate
```

### 添加更多插件
编辑 `diy-part1.sh` 添加软件源：
```bash
sed -i '$a src-git passwall https://github.com/xiaorouji/openwrt-passwall.git' feeds.conf.default
```

编辑 `diy-part2.sh` 安装插件：
```bash
./scripts/feeds install -a luci-app-passwall
```

### 修改编译选项
```bash
cd immortalwrt-mt798x
make menuconfig
# 保存配置到 .config
cp .config ../n60-pro.config
```

## 🔍 常见问题

### Q: 为什么不直接用 iStoreOS 官方源码？
**A:** iStoreOS 官方可能没有针对 N60 Pro (MT7981B) 的完整支持，而 ImmortalWrt MT798x 专门优化了这个平台。

### Q: 编译需要多长时间？
**A:** 首次编译 2-6 小时，二次编译 30分钟-2小时（取决于硬件和网络）。

### Q: 固件是否稳定？
**A:** 基于稳定的 OpenWrt 24.10 + 6.6 LTS 内核，经过社区测试。

### Q: 可以在线升级吗？
**A:** 可以，通过 Web 界面上传 sysupgrade.bin 文件升级。

## 🔗 相关资源

- **ImmortalWrt MT798x**: https://github.com/padavanonly/immortalwrt-mt798x-6.6
- **iStoreOS**: https://github.com/istoreos/istoreos
- **OpenWrt 文档**: https://openwrt.org/docs/start
- **iStore 应用商店**: https://github.com/linkease/istore

## 📝 许可证

本项目遵循 GPL-2.0 许可证，与 OpenWrt/ImmortalWrt/iStoreOS 保持一致。

## 🙏 致谢

感谢以下开源项目：
- **ImmortalWrt MT798x** - 提供优秀的 MT7981B 支持
- **iStoreOS** - 提供易用的应用商店和向导
- **OpenWrt** - 提供固件基础
- 所有贡献者和测试者

---

**编译愉快！** 🎉

如有问题，请查看 `快速指南.md` 或提交 Issue。
